<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament</title>
</head>
<body>
    <div id="create">
        <label id="label-create" for="btn-create">Tournament</label>
        <button id="btn-create" onclick="createTournament()">create tournament</button>
    </div>

    <br>
    <div>
        <label for="custom-message">Custom Message</label>
        <input id="custom-message" type="text">
        <button onclick="sendCustomMessage()">send</button>
    </div>
    <br>

    <div id="creating" style="visibility: hidden;">
        <h1>creating tournament...</h1>
    </div>

    <ul id="players">
    </ul>

    </div>
</body>
<script>
    function getRandomId(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

    let ws_notification = new WebSocket("ws://localhost:8000/notification/")
    let ws_tournament = new WebSocket("ws://localhost:8000/tournament/")
    let payload = {
        action: "",
        player_id: getRandomId(1, 3999999999),
        tournament_id: null,
    }

    function createTournament() {
        document.getElementById("create").style.visibility = 'hidden'
        document.getElementById("creating").style.visibility = 'visible'
        
        payload.action = "create"
        ws_tournament.send(JSON.stringify(payload))
    }

    function addPlayerToList(data) {
        const list = document.getElementById("players")
        const item = document.createElement("li")
        item.innerText = payload.player_id
        list.appendChild(item)
    }

    function registerToNotification() {
        payload.action = "register"
        ws_notification.send(JSON.stringify(payload))
    }

    function sendCustomMessage() {
        const message = document.getElementById("custom-message").value
        payload.action = "message"
        payload.message = message
        ws_notification.send(JSON.stringify(payload))
    }

    document.addEventListener("DOMContentLoaded", function() {
        ws_tournament.onmessage = (event) => {
            data = JSON.parse(event.data)
                console.log(data)

            if (data.status == "enter_tournament") {
                addPlayerToList(data)
                payload.tournament_id = data.tournament_id
                return 
            }
        };

        ws_notification.onmessage = (event) => {
            data = JSON.parse(event.data)
                console.log(data)

            if (data.status == "connected") {
                registerToNotification()
                payload.tournament_id = data.tournament_id
                return 
            }
        };

      });
</script>
<style>

    * {
        color: whitesmoke;
        background-color: rgb(24, 23, 23);
    }
</style>
</html>