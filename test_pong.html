<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Pong</title>
</head>
<body style="background-color: black; display: flex; justify-content: center; height: 100vh; align-items: center;">
    <div class="table">
        <div id="player_left" class="player player_left"></div>
        <div id="ball" class="ball"></div>
        <div class="player player_right"></div>
    </div>
</body>
<style>
    html, body {
        overflow: hidden;
      }
    
    .table {
        position: relative;
        margin: 5px; 
        width: 1280px; 
        height: 720px; 
        border: 1px; 
        border-color: black; 
        background-color: rgb(39, 56, 56);
    }

    .player {
        position: absolute;
        height: 100px;
        width: 20px;
        background-color: aqua;
    }

    .player_left {
        top: 310px;
    }

    .player_right {
        top: 310px;
        right: 0;
    }

    .ball {
        border-radius: 100%;
        height: 20px;
        width: 20px;
        background-color: aquamarine;
        position: absolute;
        top: 340px;
        left: 630px;
    }
</style>
<script>
    function getRandomId(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

    let ws = new WebSocket("ws://localhost:8000/player/")
    let payload = {
        key: "",
        player_id: getRandomId(1, 3999999999),
        match_id: -1,
        action: ""
    }
    let left_player = null

    document.addEventListener("DOMContentLoaded", function() {
        ws.onmessage = (event) => {
            message = JSON.parse(event.data)
    
            console.log(message)
    
            if (message.action == "coordinates") {
                const player_height = 100
                const ball_radious = 10
                ball = document.getElementById("ball");
                ball.style.left = `${message.ball.x - ball_radious}px`
                ball.style.top = `${message.ball.y - ball_radious}px`

                player = document.getElementById("player_left");
                player.style.top = `${message.player.y - (player_height / 2)}px`
                return ;
            }

            if (message.action == "connect") {
                console.log("start connection")
                payload.match_id = message.match_id
                payload.action = "ready"
                ws.send(JSON.stringify(payload))
            }
    
        };
      });




    async function sendKey(key) {
        payload.key = key
        payload.action = "move"
        ws.send(JSON.stringify(payload))
    }

    // Function to execute when the key is pressed
    async function onKeyPress(key) {
        //console.log(key + " key pressed");
        sendKey(key)
    }

    // Function to execute when the key is released
    async function onKeyRelease(key) {
        //console.log(key + " key released");
    }

    // Event listener for keydown
    document.addEventListener('keydown', async function(event) {
        if (event.key === 'ArrowUp') {
            onKeyPress('Up');
        } else if (event.key === 'ArrowDown') {
            onKeyPress('Down');
        }
    });

    // Event listener for keyup
    document.addEventListener('keyup', function(event) {
        if (event.key === 'ArrowUp') {
            onKeyRelease('Up');
        } else if (event.key === 'ArrowDown') {
            onKeyRelease('Down');
        }
    });
</script>
</html>